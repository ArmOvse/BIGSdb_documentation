<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Installation and configuration of BIGSdb &mdash; BIGSdb 1.9.0 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.9.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="BIGSdb 1.9.0 documentation" href="index.html" />
    <link rel="prev" title="BIGSdb Dependencies" href="dependencies.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="dependencies.html" title="BIGSdb Dependencies"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">BIGSdb 1.9.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="installation-and-configuration-of-bigsdb">
<h1>Installation and configuration of BIGSdb<a class="headerlink" href="#installation-and-configuration-of-bigsdb" title="Permalink to this headline">¶</a></h1>
<div class="section" id="software-installation">
<h2>Software installation<a class="headerlink" href="#software-installation" title="Permalink to this headline">¶</a></h2>
<p>BIGSdb consists of two main Perl scripts, bigsdb.pl and bigscurate.pl, that run the query and curator&#8217;s interfaces respectively. These need to be located somewhere within the web cgi-bin directories. In addition, there are a large number of library files, used by both these scripts, that are installed by default in /usr/local/lib/BIGSdb. Plugin scripts are stored within a &#8216;Plugins&#8217; sub-directory of this library directory.</p>
<p>All databases on a system can use the same instance of the scripts, or alternatively any database can specify a particular path for each script, enabling these script directories to be protected by apache htaccess directives.</p>
<blockquote>
<div><ul class="simple">
<li>Software requirements</li>
<li>Download from <a class="reference external" href="http://sourceforge.net/projects/bigsdb/">SourceForge.net</a> or <a class="reference external" href="https://github.com/kjolley/BIGSdb">GitHub</a>.</li>
</ul>
</div></blockquote>
<ol class="arabic">
<li><p class="first">Unpack the distribution package in a temporary directory:</p>
<div class="highlight-python"><div class="highlight"><pre>gunzip bigsdb_1.x.x.tar.gz
tar xvf bigsdb_1.x.x.tar
</pre></div>
</div>
</li>
<li><p class="first">Copy the bigsdb.pl and bigscurate.pl scripts to a subdirectory of your web server&#8217;s cgi-bin directory. Make sure these are readable and executable by the web server daemon.</p>
</li>
<li><p class="first">Copy the contents of the lib directory to /usr/local/lib/BIGSdb/. Make sure you include the Plugins and Offline directories which are subdirectories of the main lib directory.</p>
</li>
<li><p class="first">Copy the contents of the javascript directory to a javascript directory within the web root tree, i.e. accessible from <a class="reference external" href="http://your_website/javascript/">http://your_website/javascript/</a>.</p>
</li>
<li><p class="first">Copy the bigsdb.css stylesheet to the root directory of your website, i.e. accessible from <a class="reference external" href="http://your_website/bigsdb.css">http://your_website/bigsdb.css</a>.</p>
</li>
<li><p class="first">Copy the images directory to the root directory of your website, i.e. accessible from <a class="reference external" href="http://your_website/images">http://your_website/images</a>.</p>
</li>
<li><p class="first">Copy the contents of the conf directory to /etc/bigsdb/. Check the paths of helper applications and database names in the bigsdb.conf file and modify for your system.</p>
</li>
<li><p class="first">Create a PostgreSQL database user called apache - this should not have any special priveleges. Use the createuser command to do this, e.g.</p>
<div class="highlight-python"><div class="highlight"><pre>createuser apache
</pre></div>
</div>
<p>From the psql command line, set the apache user password:</p>
<div class="highlight-python"><div class="highlight"><pre>psql
ALTER ROLE apache WITH PASSWORD &#39;remote&#39;;
</pre></div>
</div>
</li>
<li><p class="first">Create PostgreSQL databases called bigsdb_auth, bigsdb_prefs and refs using the scripts in the sql directory. Create the database using the createdb command and set up the tables using the psql command, e.g.</p>
<div class="highlight-python"><div class="highlight"><pre>createdb bigsdb_auth
psql -f auth.sql bigsdb_auth
</pre></div>
</div>
</li>
<li><p class="first">Create a writable temporary directory in the root of the web site called tmp, i.e. accessible from <a class="reference external" href="http://your_website/tmp">http://your_website/tmp</a>.</p>
</li>
<li><p class="first">Create a log file, bigsdb.log, in /var/log owned by the web server daemon, e.g.</p>
<div class="highlight-python"><div class="highlight"><pre>touch /var/log/bigsdb.log
chown www-data /var/log/bigsdb.log
</pre></div>
</div>
</li>
</ol>
<blockquote>
<div>(substitute www-data for the web daemon user).</div></blockquote>
<div class="section" id="site-specific-configuration">
<h3>Site-specific configuration<a class="headerlink" href="#site-specific-configuration" title="Permalink to this headline">¶</a></h3>
<p>Site-specific configuration files are located in /etc/bigsdb by default.</p>
<ul class="simple">
<li><a class="reference download internal" href="_downloads/bigsdb.conf"><tt class="xref download docutils literal"><span class="pre">bigsdb.conf</span></tt></a> - main configuration file</li>
<li><a class="reference download internal" href="_downloads/logging.conf"><tt class="xref download docutils literal"><span class="pre">logging.conf</span></tt></a> - error logging settings. See log4perl project website for advanced configuration details.</li>
</ul>
</div>
<div class="section" id="database-specific-configuration">
<h3>Database-specific configuration<a class="headerlink" href="#database-specific-configuration" title="Permalink to this headline">¶</a></h3>
<p>Details for creating the databases can be found in the software distribution package.</p>
<p>Each BIGSdb database on a system has its own configuration directory, by default in /etc/bigsdb/dbases. The database has a short configuration name used to specify it in a web query and this matches the name of the configuration sub-directory, e.g. <a class="reference external" href="http://pubmlst.org/cgi-bin/bigsdb/bigsdb.pl?db=pubmlst_neisseria_isolates">http://pubmlst.org/cgi-bin/bigsdb/bigsdb.pl?db=pubmlst_neisseria_isolates</a> is the URL of the front page of the PubMLST Neisseria isolate database whose configuration settings are stored in /etc/bigsdb/dbases/pubmlst_neisseria_isolates. This database sub-directory contains a number of files (hyperlinks lead to the files used on the Neisseria database):</p>
<ul class="simple">
<li><a class="reference download internal" href="_downloads/config.xml"><tt class="xref download docutils literal"><span class="pre">config.xml</span></tt></a> - the database configuration file. Fields defined here correspond to fields in the isolate table of the database.</li>
<li>banner.html - optional file containing text that will appear as a banner within the database index pages. HTML markup can be used within this text.</li>
<li>header.html - HTML markup that is inserted at the top of all pages. This can be used to set up site-specific menubars and logos.</li>
<li>footer.html - HTML markup that is inserted at the bottom of all pages.</li>
<li>curate_header.html - HTML markup that is inserted at the top of all curator&#8217;s interface pages.</li>
<li>curate_footer.html - HTML markup that is inserted at the bottom of all curator&#8217;s interface pages.</li>
</ul>
</div>
<div class="section" id="user-authentication">
<h3>User authentication<a class="headerlink" href="#user-authentication" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="xml-configuration-attributes-used-in-config-xml">
<h3>XML configuration attributes used in config.xml<a class="headerlink" href="#xml-configuration-attributes-used-in-config-xml" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="setting-up-the-admin-user">
<h3>Setting up the admin user<a class="headerlink" href="#setting-up-the-admin-user" title="Permalink to this headline">¶</a></h3>
<p>The first admin user needs to be manually added to the users table of the database. Connect to the database using psql and add the following (changing details to suit the user).:</p>
<div class="highlight-python"><div class="highlight"><pre>INSERT INTO users (id,user_name,surname,first_name,email,affiliation,status,date_entered,datestamp,curator) VALUES (1,&#39;keith&#39;,&#39;Jolley&#39;,&#39;Keith&#39;,&#39;keith.jolley@zoo.ox.ac.uk&#39;,&#39;University of Oxford, UK&#39;,&#39;admin&#39;,&#39;today&#39;,&#39;today&#39;,1);
</pre></div>
</div>
<p>If you are using built-in authentication, set the password for this user using the add_user.pl script. Other users can be added by the admin user from the curation interface accessible from <a class="reference external" href="http://your_website/cgi-bin/private/bigscurate.pl?db=test_db">http://your_website/cgi-bin/private/bigscurate.pl?db=test_db</a> (or wherever you have located your bigscurate.pl script).</p>
</div>
<div class="section" id="setting-up-the-offline-job-manager">
<h3>Setting up the offline job manager<a class="headerlink" href="#setting-up-the-offline-job-manager" title="Permalink to this headline">¶</a></h3>
<p>To run plugins that require a long time to complete their analyses, an offline job manager has been developed. The plugin will save the parameters of a job to a job database and then provide a link to the job status page. An offline script, run frequently from CRON, will then process the job queue and update status and outputs via the job status page.</p>
<ol class="arabic">
<li><p class="first">Create a &#8216;bigsdb&#8217; UNIX user, e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre>sudo useradd -s /bin/sh bigsdb
</pre></div>
</div>
</li>
<li><p class="first">As the postgres user, create a &#8216;bigsdb&#8217; user and create a bigsdb_jobs database using the jobs.sql SQL file, e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre>createuser bigsdb [no need for special priveleges]
createdb bigsdb_jobs
psql -f jobs.sql bigsdb_jobs
</pre></div>
</div>
<p>From the psql command line, set the bigsdb user password::</p>
<div class="highlight-python"><div class="highlight"><pre>psql
ALTER ROLE bigsdb WITH PASSWORD &#39;bigsdb&#39;;
</pre></div>
</div>
</li>
<li><p class="first">Set up the jobs parameters in the /etc/bigsdb/bigsdb.conf file, e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">jobs_db</span><span class="o">=</span><span class="n">bigsdb_jobs</span>
<span class="n">max_load</span><span class="o">=</span><span class="mi">8</span>
</pre></div>
</div>
<p>The jobs script will not process a job if the server&#8217;s load average (over the last minute) is higher than the max_load parameter. This should be set higher than the number of processor cores or you may find that jobs never run on a busy server. Setting it to double the number of cores is probably a good starting point.</p>
</li>
<li><p class="first">Copy the job_logging.conf file to the /etc/bigsdb directory.</p>
</li>
<li><p class="first">Set the script to run frequently (preferably every minute) from CRON. Note that CRON does not like &#8216;.&#8217; in executable filenames, so either rename the script to &#8216;bigsjobs&#8217; or create a symlink and call that from CRON, e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre>copy bigsjobs.pl to /usr/local/bin
sudo ln -s /usr/local/bin/bigsjobs.pl /usr/local/bin/bigsjobs
</pre></div>
</div>
<p>You should install xvfb, which is a virtual X server that may be required for third party applications called from plugins. This is required, for example, for calling splitstree4 from the Genome Comparator plugin.</p>
<p>Add the following to /etc/crontab::</p>
<div class="highlight-python"><div class="highlight"><pre>* * * * * bigsdb xvfb-run -a /usr/local/bin/bigsjobs
</pre></div>
</div>
<p>(set to run every minute from the &#8216;bigsdb&#8217; user account).</p>
</li>
<li><p class="first">Create a log file, bigsdb_jobs.log, in /var/log owned by &#8216;bigsdb&#8217;, e.g.:</p>
<div class="highlight-python"><div class="highlight"><pre>sudo touch /var/log/bigsdb_jobs.log
sudo chown bigsdb /var/log/bigsdb_jobs.log
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="periodically-delete-temporary-files">
<h3>Periodically delete temporary files<a class="headerlink" href="#periodically-delete-temporary-files" title="Permalink to this headline">¶</a></h3>
<p>There are two temporary directories (one public, one private) which may accumulate temporary files over time. Some of these are deleted automatically when no longer required but some cannot be cleaned automatically since they are used to display results after clicking a link or to pass the database query between pages of results.</p>
<p>The easiest way to clean the temp directories is to run a cleaning script periodically, e.g. create a root-executable script in /etc/cron.hourly containing the following::</p>
<div class="highlight-python"><div class="highlight"><pre>#!/bin/sh
#Remove temp BIGSdb files from secure tmp folder older than 1 week.
find /var/tmp/ -name &#39;*BIGSdb_*&#39; -type f -mmin +10080 -exec rm -f {} \; 2&gt;/dev/null

#Remove .jnlp files from web tree older than 1 day
find /var/www/tmp/ -name &#39;*.jnlp&#39; -type f -mmin +1440 -exec rm -f {} \; 2&gt;/dev/null

#Remove other tmp files from web tree older than 1 week
find /var/www/tmp/ -type f -mmin +10080 -exec rm -f {} \; 2&gt;/dev/null
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Installation and configuration of BIGSdb</a><ul>
<li><a class="reference internal" href="#software-installation">Software installation</a><ul>
<li><a class="reference internal" href="#site-specific-configuration">Site-specific configuration</a></li>
<li><a class="reference internal" href="#database-specific-configuration">Database-specific configuration</a></li>
<li><a class="reference internal" href="#user-authentication">User authentication</a></li>
<li><a class="reference internal" href="#xml-configuration-attributes-used-in-config-xml">XML configuration attributes used in config.xml</a></li>
<li><a class="reference internal" href="#setting-up-the-admin-user">Setting up the admin user</a></li>
<li><a class="reference internal" href="#setting-up-the-offline-job-manager">Setting up the offline job manager</a></li>
<li><a class="reference internal" href="#periodically-delete-temporary-files">Periodically delete temporary files</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="dependencies.html"
                        title="previous chapter">BIGSdb Dependencies</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/installation.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="dependencies.html" title="BIGSdb Dependencies"
             >previous</a> |</li>
        <li><a href="index.html">BIGSdb 1.9.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, Keith Jolley.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>